<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Editor - Neuropilot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        .toolbar-btn {
            @apply w-12 h-12 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors cursor-pointer;
        }
        
        .toolbar-btn.active {
            @apply bg-blue-100 text-blue-600;
        }
        
        .canvas-container {
            background: 
                linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
                linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
                linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .neuropilot-suggestion {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .element {
            position: absolute;
            cursor: move;
            border: 2px dashed transparent;
        }
        
        .element:hover {
            border-color: var(--primary);
        }
        
        .element.selected {
            border-color: var(--primary);
            border-style: solid;
        }
    </style>
</head>
<body class="h-screen flex flex-col">
    <!-- Top Navigation -->
    <nav class="bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <a href="{% url 'dashboard' %}" class="flex items-center gap-2 text-gray-700 hover:text-gray-900">
                <i class="fas fa-arrow-left"></i>
                <span>Back to Dashboard</span>
            </a>
            <div class="w-px h-6 bg-gray-300"></div>
            <h1 class="text-lg font-semibold text-gray-800" id="projectTitle">New Project</h1>
        </div>
        
        <div class="flex items-center gap-4">
            <!-- ML Status Indicator -->
            <div id="mlStatus" class="flex items-center gap-2 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span>Neuropilot AI Active</span>
            </div>
            
            <div class="flex items-center gap-2">
                <button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                    <i class="fas fa-save mr-2"></i>Save
                </button>
                <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
            </div>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden">
        <!-- Left Toolbar -->
        <div class="w-16 bg-white border-r border-gray-200 flex flex-col items-center py-4 gap-4">
            <div class="toolbar-btn active" data-tool="select">
                <i class="fas fa-mouse-pointer"></i>
            </div>
            <div class="toolbar-btn" data-tool="rectangle">
                <i class="fas fa-square"></i>
            </div>
            <div class="toolbar-btn" data-tool="circle">
                <i class="fas fa-circle"></i>
            </div>
            <div class="toolbar-btn" data-tool="text">
                <i class="fas fa-font"></i>
            </div>
            <div class="toolbar-btn" data-tool="line">
                <i class="fas fa-minus"></i>
            </div>
            <div class="w-8 h-px bg-gray-200 my-2"></div>
            <div class="toolbar-btn" data-tool="color">
                <i class="fas fa-palette"></i>
            </div>
            <div class="toolbar-btn" data-tool="layers">
                <i class="fas fa-layer-group"></i>
            </div>
        </div>

        <!-- Main Canvas Area -->
        <div class="flex-1 flex flex-col">
            <div class="canvas-container flex-1 relative overflow-auto" id="mainCanvas">
                <!-- Canvas will be dynamically populated -->
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="text-center text-gray-400">
                        <i class="fas fa-plus-circle text-4xl mb-4"></i>
                        <p>Start designing! Use tools from the left toolbar.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel - Properties & Neuropilot Suggestions -->
        <div class="w-80 bg-white border-l border-gray-200 flex flex-col">
            <!-- Properties Panel -->
            <div class="p-4 border-b border-gray-200">
                <h3 class="font-semibold text-gray-800 mb-4">Properties</h3>
                <div id="propertiesPanel">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Width</label>
                            <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-lg" value="800">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Height</label>
                            <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-lg" value="600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Background</label>
                            <input type="color" class="w-full h-10 rounded-lg border border-gray-300" value="#ffffff">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Neuropilot AI Suggestions Panel -->
            <div class="flex-1 p-4 overflow-y-auto">
                <h3 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-robot text-blue-600"></i>
                    Neuropilot AI
                </h3>
                
                <div id="suggestionsPanel" class="space-y-3">
                    <!-- Suggestions will be populated here by ML system -->
                    <div class="neuropilot-suggestion p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-lightbulb text-blue-600 text-xs"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-blue-900 text-sm mb-1">Color Contrast Suggestion</div>
                                <p class="text-blue-700 text-xs">Consider increasing contrast for better accessibility</p>
                                <button class="mt-2 text-xs text-blue-600 hover:text-blue-800 font-medium">
                                    Apply Suggestion
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neuropilot-suggestion p-3 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-magic text-green-600 text-xs"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-green-900 text-sm mb-1">Layout Optimization</div>
                                <p class="text-green-700 text-xs">Elements could be better aligned for cognitive flow</p>
                                <button class="mt-2 text-xs text-green-600 hover:text-green-800 font-medium">
                                    Optimize Layout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ML Interaction Metrics -->
                <div class="mt-6 p-3 bg-gray-50 rounded-lg">
                    <h4 class="font-medium text-gray-800 text-sm mb-2">AI Insights</h4>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Hesitation Detected:</span>
                            <span class="font-medium" id="hesitationCount">2 times</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Suggestions Made:</span>
                            <span class="font-medium" id="suggestionCount">5</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Confidence Level:</span>
                            <span class="font-medium text-green-600" id="confidenceLevel">87%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Status Bar -->
    <div class="bg-white border-t border-gray-200 px-4 py-2 flex items-center justify-between text-sm text-gray-600">
        <div class="flex items-center gap-6">
            <div>Canvas: <span id="canvasSize">800 Ã— 600</span></div>
            <div>Zoom: <span id="zoomLevel">100%</span></div>
            <div>Selected: <span id="selectedElement">None</span></div>
        </div>
        <div class="flex items-center gap-4">
            <button id="mlHelpBtn" class="flex items-center gap-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                <i class="fas fa-robot"></i>
                Get AI Help
            </button>
        </div>
    </div>

    <script>
        // Simple Design Editor Functionality
        class NeuropilotDesignEditor {
            constructor() {
                this.currentTool = 'select';
                this.selectedElement = null;
                this.interactionHistory = [];
                this.setupEventListeners();
                this.startMLMonitoring();
            }
            
            setupEventListeners() {
                // Tool selection
                document.querySelectorAll('.toolbar-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.toolbar-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentTool = btn.dataset.tool;
                        this.trackInteraction('tool_selected', this.currentTool);
                    });
                });
                
                // Canvas interactions
                const canvas = document.getElementById('mainCanvas');
                canvas.addEventListener('click', (e) => {
                    this.handleCanvasClick(e);
                });
                
                // ML Help button
                document.getElementById('mlHelpBtn').addEventListener('click', () => {
                    this.requestAIHelp();
                });
            }
            
            handleCanvasClick(event) {
                if (this.currentTool === 'select') {
                    // Handle element selection
                    this.trackInteraction('canvas_click', { x: event.clientX, y: event.clientY });
                } else {
                    // Create new element based on selected tool
                    this.createElement(this.currentTool, event.clientX, event.clientY);
                    this.trackInteraction('element_created', { tool: this.currentTool, x: event.clientX, y: event.clientY });
                }
            }
            
            createElement(tool, x, y) {
                const element = document.createElement('div');
                element.className = 'element';
                
                switch(tool) {
                    case 'rectangle':
                        element.style.width = '100px';
                        element.style.height = '60px';
                        element.style.backgroundColor = '#4361ee';
                        break;
                    case 'circle':
                        element.style.width = '80px';
                        element.style.height = '80px';
                        element.style.backgroundColor = '#f72585';
                        element.style.borderRadius = '50%';
                        break;
                    case 'text':
                        element.style.padding = '10px';
                        element.style.backgroundColor = '#ffffff';
                        element.style.border = '1px solid #e5e7eb';
                        element.innerHTML = 'Double click to edit text';
                        break;
                }
                
                element.style.left = (x - 50) + 'px';
                element.style.top = (y - 50) + 'px';
                
                element.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectElement(element);
                });
                
                document.getElementById('mainCanvas').appendChild(element);
            }
            
            selectElement(element) {
                if (this.selectedElement) {
                    this.selectedElement.classList.remove('selected');
                }
                element.classList.add('selected');
                this.selectedElement = element;
                document.getElementById('selectedElement').textContent = element.style.backgroundColor || 'Text Element';
            }
            
            trackInteraction(type, data) {
                this.interactionHistory.push({
                    type,
                    data,
                    timestamp: Date.now(),
                    tool: this.currentTool
                });
                
                // Keep only last 50 interactions
                if (this.interactionHistory.length > 50) {
                    this.interactionHistory.shift();
                }
                
                // Simulate ML analysis
                this.analyzeInteractionPatterns();
            }
            
            startMLMonitoring() {
                // Simulate real-time ML monitoring
                setInterval(() => {
                    this.updateMLMetrics();
                }, 3000);
            }
            
            analyzeInteractionPatterns() {
                // Simulate ML analysis of user behavior
                const recentInteractions = this.interactionHistory.slice(-10);
                const hesitationPatterns = recentInteractions.filter(i => 
                    i.type === 'canvas_click' && 
                    recentInteractions.some(prev => 
                        prev.type === 'tool_selected' && 
                        i.timestamp - prev.timestamp > 2000
                    )
                );
                
                if (hesitationPatterns.length > 2) {
                    this.showHesitationSuggestion();
                }
            }
            
            showHesitationSuggestion() {
                const suggestions = [
                    "Try using the rectangle tool for creating boxes",
                    "Consider adding text labels to your elements",
                    "The color palette tool might help with styling",
                    "Would you like help with layout alignment?"
                ];
                
                const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
                this.addSuggestion("Hesitation Detected", randomSuggestion);
            }
            
            addSuggestion(title, message) {
                const suggestionPanel = document.getElementById('suggestionsPanel');
                const suggestion = document.createElement('div');
                suggestion.className = 'neuropilot-suggestion p-3 bg-purple-50 border border-purple-200 rounded-lg';
                suggestion.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-brain text-purple-600 text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-purple-900 text-sm mb-1">${title}</div>
                            <p class="text-purple-700 text-xs">${message}</p>
                            <button class="mt-2 text-xs text-purple-600 hover:text-purple-800 font-medium" onclick="this.parentElement.parentElement.parentElement.remove(); updateSuggestionCount();">
                                Dismiss
                            </button>
                        </div>
                    </div>
                `;
                
                suggestionPanel.insertBefore(suggestion, suggestionPanel.firstChild);
                this.updateSuggestionCount();
            }
            
            updateSuggestionCount() {
                const count = document.getElementById('suggestionsPanel').children.length;
                document.getElementById('suggestionCount').textContent = count;
            }
            
            updateMLMetrics() {
                // Simulate updating ML metrics
                document.getElementById('hesitationCount').textContent = 
                    Math.floor(Math.random() * 5) + ' times';
                document.getElementById('confidenceLevel').textContent = 
                    (85 + Math.floor(Math.random() * 10)) + '%';
            }
            
            async requestAIHelp() {
                // Simulate API call to Neuropilot ML system
                try {
                    const response = await fetch('/ml/predict/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            inactivity_time: 2.5,
                            tool_id: this.currentTool,
                            cursor_velocity: 15.2,
                            click_frequency: 3.1,
                            session_duration: 300,
                            recent_commands: this.interactionHistory.slice(-5).map(i => i.tool)
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success && data.prediction.hesitation) {
                        this.addSuggestion(
                            "AI Assistance", 
                            "Based on your workflow, I suggest trying the layout optimization tool."
                        );
                    }
                } catch (error) {
                    console.log('ML help request failed:', error);
                }
            }
        }
        
        // Initialize the editor when page loads
        let designEditor;
        document.addEventListener('DOMContentLoaded', function() {
            designEditor = new NeuropilotDesignEditor();
            
            // Update suggestion count initially
            designEditor.updateSuggestionCount();
        });
        
        // Helper function for suggestion dismissal
        function updateSuggestionCount() {
            if (designEditor) {
                designEditor.updateSuggestionCount();
            }
        }
    </script>
</body>
</html>